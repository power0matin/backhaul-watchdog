# Config
PING_TARGETS="8.8.8.8 1.1.1.1"
MAX_LATENCY=200
CHECK_INTERVAL=30
SERVICE_NAME="backhaul"
COOLDOWN=300
TELEGRAM_BOT_TOKEN=""
TELEGRAM_CHAT_ID=""

#!/bin/bash
set -euo pipefail

# Color codes
GREEN='\033[0;32m'
RED='\033[0;31m'
CYAN='\033[1;36m'
NC='\033[0m'

# Check root privileges
if [[ $EUID -ne 0 ]]; then
    echo -e "${RED}‚ùå This script must be run as root${NC}"
    logger -t backhaul-watchdog "Uninstallation failed: root privileges required"
    exit 1
fi

echo -e "${CYAN}üóëÔ∏è Uninstalling Backhaul Watchdog...${NC}"

# Stop and disable services
echo -e "${GREEN}üõë Stopping services...${NC}"
systemctl stop backhaul-watchdog.timer || true
systemctl disable backhaul-watchdog.timer || true
logger -t backhaul-watchdog "Stopped and disabled backhaul-watchdog.timer"

# Remove systemd files
echo -e "${GREEN}üóëÔ∏è Removing systemd files...${NC}"
rm -f /etc/systemd/system/backhaul-watchdog.service
rm -f /etc/systemd/system/backhaul-watchdog.timer

# Remove files
echo -e "${GREEN}üóëÔ∏è Removing watchdog files...${NC}"
rm -rf /etc/backhaul_watchdog
rm -rf /var/lib/backhaul_watchdog
rm -rf /usr/local/bin/backhaul_watchdog
rm -f /usr/local/bin/install.sh

# Remove alias
echo -e "${GREEN}üóëÔ∏è Removing CLI alias...${NC}"
sed -i '/alias watchdog=/d' /root/.bashrc

# Reload systemd
echo -e "${GREEN}üîÑ Reloading systemd...${NC}"
systemctl daemon-reexec
systemctl daemon-reload

echo -e "${GREEN}‚úÖ Uninstallation complete!${NC}"
logger -t backhaul-watchdog "Uninstallation completed successfully"